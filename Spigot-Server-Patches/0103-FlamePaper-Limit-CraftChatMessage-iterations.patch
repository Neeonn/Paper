From e8ce65e71d495b3891507e58cd860683173d8607 Mon Sep 17 00:00:00 2001
From: neon <srdjanneon@gmail.com>
Date: Sun, 14 Mar 2021 02:19:49 +0100
Subject: [PATCH] [FlamePaper] Limit CraftChatMessage iterations


diff --git a/src/main/java/net/minecraft/server/Container.java b/src/main/java/net/minecraft/server/Container.java
index 7fc49579..943f068f 100644
--- a/src/main/java/net/minecraft/server/Container.java
+++ b/src/main/java/net/minecraft/server/Container.java
@@ -106,6 +106,12 @@ public abstract class Container {
     }
 
     public Slot getSlot(int i) {
+        final int lastIndex = this.c.size() - 1;
+
+        if (i > lastIndex) {
+            i = lastIndex;
+        }
+
         return (Slot) this.c.get(i);
     }
 
diff --git a/src/main/java/org/bukkit/craftbukkit/util/CraftChatMessage.java b/src/main/java/org/bukkit/craftbukkit/util/CraftChatMessage.java
index 38ef8216..c8011b75 100644
--- a/src/main/java/org/bukkit/craftbukkit/util/CraftChatMessage.java
+++ b/src/main/java/org/bukkit/craftbukkit/util/CraftChatMessage.java
@@ -143,8 +143,15 @@ public final class CraftChatMessage {
     public static String fromComponent(IChatBaseComponent component, EnumChatFormat defaultColor) {
         if (component == null) return "";
         StringBuilder out = new StringBuilder();
+        // FlamePaper - Limit iterations to 5
+        int iterations = 0;
         
         for (IChatBaseComponent c : (Iterable<IChatBaseComponent>) component) {
+
+            if (++iterations > 2) {
+                break;
+            }
+
             ChatModifier modi = c.getChatModifier();
             out.append(modi.getColor() == null ? defaultColor : modi.getColor());
             if (modi.isBold()) {
-- 
2.30.2

